"use strict";angular.module("hbpCommon",["ui.bootstrap","ui.router","bbpConfig","bbpOidcClient","hbp-common-templates","ngResource"]).config(["$resourceProvider",function(a){a.defaults.stripTrailingSlashes=!1}]),window.hbpCommonVersion="1.1.0",angular.module("hbpCommon").controller("hbpMetaNavigationCtrl",["$rootScope","$scope","$state","hbpUserDirectory","bbpOidcSession",function(a,b,c,d,e){d.getCurrentUser().then(function(a){b.currentUser=a}),b.logout=function(){e.logout().then(function(){a.$broadcast("user:disconnected"),b.currentUser=null})}}]),angular.module("hbpCommon").directive("hbpBreadcrumb",["$state",function(a){return{restrict:"E",templateUrl:"templates/breadcrumb.html",scope:{items:"="},link:function(b){var c=function(b,c){return a.href(b,c)},d=function(){b.parentItems=b.items&&b.items.slice(0,b.items.length-1),b.currentItem=b.items&&b.items[b.items.length-1]},e=function(){b.$watch("items",d),b.urlForState=c,d()};e()}}}]),angular.module("hbpCommon").directive("hbpContentDescription",function(){return{templateUrl:"templates/content-description.html",restrict:"E",scope:{content:"=?"},link:function(a){if(a.content){var b=a.content.split("/");b.length>1?a.fallback=b[1]:a.fallback=b[0]}}}}),angular.module("hbpCommon").directive("hbpContentIcon",function(){return{templateUrl:"templates/content-icon.html",restrict:"E",scope:{content:"=?"}}}),angular.module("hbpCommon").directive("hbpErrorMessage",function(){return{restrict:"E",scope:{error:"=?hbpError"},templateUrl:"templates/error-message.html"}}),angular.module("hbpCommon").directive("hbpGeneratedIcon",function(){return{restrict:"E",scope:{text:"=hbpText",color:"=hbpColor",size:"=?hbpSize"},template:'<canvas width="{{width}}" height="{{height}}" hbp-hires-canvas></canvas>',link:{post:function(a,b){b.addClass("hbp-generated-icon");var c=function(){if(a.text&&a.width&&a.height){var c=b[0].childNodes[0],d=c.width,e=c.height,f=a.text.split(/\s+/,2),g=(""+f[0][0]+(f[1]?f[1][0]:f[0][1])).toUpperCase(),h=a.color;if(!h){var i=["#ee936d","#ea6153","#f8bd93","#308298","#e54639","#4b8f9e","#457493","#456e91"],j=7*g.charCodeAt(0)*13*g.charCodeAt(1)%i.length;h=i[j]}b.attr("style","width:"+a.width+"px; height:"+a.height+"px");var k=b[0].childNodes[0].getContext("2d"),l="Arial",m=176;k.fillStyle=h,k.fillRect(0,0,d,e),k.textAlign="center",k.textBaseline="middle",k.fillStyle="#ffffff";do m-=4,k.font=m+"px "+l;while(m>10&&k.measureText(g).width>.75*d);k.fillText(g,d/2,e/2)}};a.$watch("[text,width,height]",c,!0),a.width=a.size||b[0].offsetWidth,a.height=a.size||b[0].offsetHeight,c()}}}}),angular.module("hbpCommon").directive("hbpHiresCanvas",["hbpHiResService",function(a){return{link:{post:function(b,c,d){var e=a.pixelRatio(),f=function(a){return function(b){if(b){var d=b;c.css(a,d+"px").prop(a,d*e)}}};a.isHiResScreen()&&c[0].getContext("2d").transform(e,0,0,e,0,0),d.$observe("width",f("width")),d.$observe("height",f("height"))}}}}]),angular.module("hbpCommon").directive("hbpIcon",function(){return{templateUrl:"templates/icon.html",restrict:"E",scope:{entity:"=?",type:"=?"},link:function(a){!a.type&&a.entity&&(a.type=a.entity._entityType)}}}),angular.module("hbpCommon").directive("hbpOnTouch",["$parse",function(a){return{restrict:"A",compile:function(b,c){var d=a(c.hbpOnTouch);return function(a,b){b.on("touchend",function(b){b.preventDefault();var c=function(){d(a,{$event:b})};a.$apply(c)})}}}}]),angular.module("hbpCommon").directive("hbpPerformAction",[function(){return{restrict:"A",scope:{action:"&hbpPerformAction"},link:function(a,b,c){var d=!1,e=function(){b.html(a.text),b.attr("disabled",!1),d=!1},f=function(){d=!0,a.loadingMessage&&b.html(a.loadingMessage),b.attr("disabled",!0),a.action().then(e,e)};a.loadingMessage=c.hbpLoadingMessage,a.text=a.text||b.html(),b.on("click",f)}}}]),angular.module("hbpCommon").directive("hbpUpNav",["$rootScope","$timeout","hbpUserDirectory","bbpOidcSession","bbpConfig",function(a,b,c,d,e){return{restrict:"A",scope:{data:"=?hbpUpNav"},link:function(f,g){f.data=f.data||{},f.data.dataUrl||(f.data.dataUrl=e.get("up.config",!1));var h=function(){d.logout().then(function(){a.$broadcast("user:disconnected")})};f.$on("user:disconnected",function(){g[0].hbpUpNav({user:null,logout:null})}),f.data&&b(function(){g[0].hbpUpNav(f.data)},0),c.getCurrentUser().then(function(a){g[0].hbpUpNav({user:{displayName:a.displayName,id:a.id},logout:h})})}}}]),angular.module("hbpCommon").directive("hbpUserSelector",["$q","$http","bbpConfig","hbpUtil","hbpUserDirectory",function(a,b,c,d,e){return{restrict:"EA",scope:{exclude:"=hbpUserExclude",onUserSelect:"&hbpOnSelect"},templateUrl:function(a,b){return b.hbpTemplate||"templates/userSelector.html"},controller:["$scope",function(b){b.idsToExclude=[],b.$watch("exclude",function(a){a&&a.length>0&&a[0].id?b.idsToExclude=_.pluck(b.exclude,"id"):a&&(b.idsToExclude=a)}),b.noSubmitOnEnter=function(a){13===a.which&&a.preventDefault()},b.getUsers=function(a){var c=[];return e.list({filter:{displayName:"*"+a+"*"}}).then(function(a){return _.forEach(a.results,function(a){b.idsToExclude.indexOf(a.id)<0&&c.push(a)}),c},d.ferr)},b.selectUser=function(){var c=b.onUserSelect({user:b.newUser});b.selectionDisabled=!0;var d=function(){b.selectionDisabled=!1,b.newUser=""};a.when(c).then(d,d)}}]}}]),angular.module("hbpCommon").directive("hbpUsercard",function(){return{restrict:"EA",scope:{user:"=hbpUser"},templateUrl:function(a,b){return b.hbpTemplate||"templates/usercard.html"},link:{pre:function(a){a.$watch("user",function(b){a.institution=b&&_.find(b.institutions,"primary"),a.email=b&&_(b.emails).filter("primary").pluck("value").first(),a.phone=b&&_(b.phones).filter("primary").pluck("value").first(),a.ims=b&&b.ims})}}}}),angular.module("hbpCommon").filter("hbpDollarToNewLine",function(){return function(a){return a&&a.replace(/ \$ /g,"\n")}}),angular.module("hbpCommon").filter("hbpYesNo",function(){return function(a){return!a||["0","false","no"].indexOf(a.toString().toLowerCase())>-1?"No":"Yes"}}),angular.module("hbpCommon").service("hbpCollabStore",["$log","$q","$cacheFactory","$window","$http","bbpConfig","hbpUserDirectory","hbpErrorService","hbpUtil",function(a,b,c,d,e,f,g,h,i){var j=null,k=f.get("api.collab.v0"),l=k+"/collab/",m=k+"/mycollabs/",n=l+"context/",o=c("hbpCollabStoreCollabs"),p=this.Collab=function(){};p.prototype={toJson:function(){return{id:this.id,title:this.title,content:this.content}},update:function(a){_.each(["id","title","content"],function(b){void 0!==a[b]&&(this[b]=a[b])},this)}},p.fromJson=function(a){if(a.toJson)return a;var b=new p;return b.id=a.id,b.created=new Date(a.created),b.edited=new Date(a.edited),b.title=a.title,b.content=a.content,b.deleted=a.deleted,b.toJson=function(){return{id:a.id,title:b.title,content:b.content,deleted:b.deleted}},b};var q=this.Context=function(){};q.fromJson=function(a){var b=new q;return b.context=a.context,b.appId=a.app_id,b.name=a.name,b.navId=a.id,b.collab=p.fromJson(a.collab),b.toJson=function(){return{context:a.context,appId:a.app_id,name:b.name}},b};var r={},s=function(a){var c=o.get(a);return c?b.when(c):r[a]?r[a]:void 0},t=function(a,c){if(!c)return b.reject(h.error({message:"id parameter is required"}));var d=s(c);return d?d:(r[c]=e.get(a+c+"/").then(function(a){return r[c]=null,p.fromJson(a.data)},function(a){return r[c]=null,i.ferr(a)}),r[c])},u=function(a,b){return a._label||(a._label=b,o.put(b,a),o.put(a.id,a)),a};this.get=function(a){return a=a&&a.id||a,t(l,a).then(function(a){return o.put(a.id,a),a})},this.getByLabel=function(a){return t(k+"/r/",a).then(function(b){var c=s(b.id);return c?c.then(function(b){return u(b,a)}):u(b,a)})},this.list=function(a,b){return a||(a=l),i.getList(a,b)().then(function(a){return a.results=_.map(a.results,function(a){return p.fromJson(a)}),a})};var v=function(){var a=[],c=function(d){return angular.forEach(d.results,function(a){this.push(a)},a),d.next&&_.isFunction(d.next)?d.next().then(c):b.when(a)};return i.getList(m)().then(c).then(function(a){return _.map(a,function(a){return p.fromJson(a)})})};this.mine=v,this.create=function(a){var b=p.fromJson(a);return e.post(l,b.toJson()).then(function(a){return b.update(a.data),o.put(b.id,b),b},i.ferr)},this.save=function(a){var b=p.fromJson(a);return e.put(l+b.id+"/",b).then(function(a){return b.update(a.data),o.put(b.id,b),b},i.ferr)},this["delete"]=function(a){return e["delete"](l+a.id+"/").then(function(){o.remove(a.id),a._label&&o.remove(a._label)},i.ferr)};var w={};this.context={get:function(a){return a?w[a]?w[a]:(w[a]=e.get(n+a+"/",{cache:!0}).then(function(b){return w[a]=null,q.fromJson(b.data)},function(b){return w[a]=null,i.ferr(b)}),w[a]):b.reject(h.error({message:"uuid parameter is required"}))}};var x={},y=function(a){return b.when(a)};this.team={add:function(a,b){return e.put(l+a+"/team/",{users:[b]}).then(j,i.ferr)},"delete":function(a,b){return e({method:"DELETE",url:l+a+"/team/",data:{users:[b]},headers:{"Content-Type":"application/json"}}).then(j,i.ferr)},list:function(a){return e.get(l+a+"/team/").then(function(b){var c=_.indexBy(b.data,"user_id");return g.list({pageSize:0,filter:{id:_.keys(c)}}).then(function(b){return _.reduce(b.result,function(b,d){var e=c[parseInt(d.id,10)];return e&&(x[a]||(x[a]={}),x[a][e.user_id]=e.role,b.push(angular.extend({},d,{membershipId:e.user_id,role:e.role}))),b},[])})},i.ferr)},userInTeam:function(a){return v().then(function(b){var c=_.indexBy(b,"id");return void 0!==c[a]},i.ferr)},roles:{get:function(b,c){return c?(x[b]||(x[b]={}),x[b]&&x[b][c]?y(x[b][c]):e.get(l+b+"/team/role/"+c+"/").then(function(a){return x[b][c]=a.data.role,y(x[b][c])},function(a){return 404===a.status?(x[b][c]=void 0,y(x[b][c])):void i.ferr(a)})):void a.debug("Must provide userId: ",b,c)},set:function(a,b,c){var d=l+a+"/team/role/"+b+"/";return x[a]&&x[a][b]?(x[a][b]=c,e.put(d,{role:c}).then(j,function(a){return 404===a.status?e.post(d,{role:c}).then(j,i.ferr):i.ferr(a)})):(x[a]||(x[a]={}),x[a][b]=c,e.post(d,{role:c}).then(j,i.ferr))}}}}]),angular.module("hbpCommon").service("hbpConfigStore",["$http","bbpConfig","hbpUtil",function(a,b,c){var d=b.get("api.collab.v0")+"/config/";this.get=function(b){return a.get(d+b+"/").then(function(a){return a.data},c.ferr)},this.list=function(a){return c.getList(d,a)()},this.create=function(b){return a.post(d,b).then(function(a){return a.data},c.ferr)},this.save=function(b){return a.put(d+b.context+"/",b).then(function(a){return a.data},c.ferr)},this["delete"]=function(b){a["delete"](d+b.context+"/").then(null,c.ferr)}}]),angular.module("hbpCommon").factory("hbpDialogFactory",["$modal","$log","$q","$rootScope","$compile","$templateCache","hbpErrorService",function(a,b,c,d,e,f,g){function h(b){b=_.extend({scope:d,title:"Confirm",confirmLabel:"Yes",cancelLabel:"No",template:"Are you sure?",closable:!0},b);var c=b.scope.$new();c.title=b.title,c.confirmLabel=b.confirmLabel,c.cancelLabel=b.cancelLabel,c.confirmationContent=b.template,c.confirmationContentUrl=b.templateUrl,c.closable=b.closable;var e=a.open({templateUrl:"templates/dialog-confirmation.html",show:!0,backdrop:"static",scope:c,keyboard:b.keyboard||b.closable});return e.result}function i(a){var b=d.$new();return b.error=a,j({"class":"error",title:"Error!",label:"Close",scope:b,templateUrl:"templates/error-alert.html"})}function j(b){if("string"==typeof b)return k.apply(window,arguments);b=_.extend({scope:d,title:"Message",label:"Close","class":"default"},b);var c=b.scope.$new();c.title=b.title,c.label=b.label,c.alertContentUrl=b.templateUrl,c.alertContent=b.template,c.htmlClass=b["class"];var e=a.open({templateUrl:"templates/dialog-alert.html",show:!0,backdrop:"static",scope:c});return e.result}function k(a,c,d){return b.warn("hbpDialogFactory.alert(templateUrl, title, scope) is deprecated."),b.log("Use hbpDialogFactory.alert(options) instead"),j({templateUrl:a,title:c,scope:d})}return{alert:j,error:i,confirm:h,confirmation:function(a,d,e,f,i){return b.warn("hbpDialogFactory.confirmation is deprecated."),b.log("Use hbpDialogFactory.confirm instead"),h({scope:i,title:e,confirmLabel:f,cancelLabel:"cancel",templateUrl:a}).then(function(){return d?d(i).then(null,function(a){var b;return"string"==typeof a?b=g.error({type:"Error",message:a}):a?(a.status||(a={status:-1,data:a}),b=g.httpError(a)):b=g.error(),j({title:"Error","class":"alert-danger",template:b.message}),c.reject(b)}):void 0})}}}]),angular.module("hbpCommon").service("hbpErrorService",function(){var a=function(a){a=angular.extend({type:"UnknownError",message:"An unknown error occured.",code:-1},a),this.type=a.type,this.message=a.message,this.data=a.data,this.code=a.code};return{httpError:function(b){if(b&&b instanceof a)return b;if(void 0===b.status)return new a({message:"Cannot parse error, invalid format."});var c=new a({code:b.status});if(0===c.code)return c.type="ClientError",c.message="The client cannot run the request.",c;if(404===c.code)return c.type="NotFound",c.message="Resource not found",c;if(403===c.code)return c.type="Forbidden",c.message="Permission denied: you are not allowed to display the page or perform the operation",c;if(502===c.code){if(c.type="BadGateway",c.message="502 Bad Gateway Error","text/html"===b.headers("content-type")){var d=document.createElement("div");d.innerHTML=b.data;var e=d.getElementsByTagName("title")[0];e&&(c.message=e.innerHTML)}return c}if(b.data){var f=b.data;f.error&&(f=f.error),f.type&&(c.type=f.type),f.data&&(c.data=f.data),f.message?c.message=f.message:f.reason&&(c.type="Error",c.message=f.reason),f.type||f.data||f.message||f.reason||(c.data=f)}return c},error:function(b){return b&&b instanceof a?b:new a(b)}}}),angular.module("hbpCommon").factory("hbpExpandableList",["$q","hbpErrorService",function(a,b){var c=function(a,b){a.data.push.apply(a.data,b.results),a.hasNext=!!b.next,a._nextImpl=b.next},d=function(a,b){a.data.unshift.apply(a.data,b.results),a.hasPrevious=!!b.previous,a._previousImpl=b.previous},e=function(a){this.data=[],c(this,a),this.hasPrevious=!!a.previous,this._previousImpl=a.previous};return e.prototype={next:function(){var b=this;return this._nextPromise?this._nextPromise:this._nextImpl?(this._nextPromise=this._nextImpl().then(function(a){return b._nextPromise=null,c(b,a),b},function(c){b._nextPromise=null,a.reject(c)}),this._nextPromise):a.reject(e.EOL)},previous:function(){var b=this;return this._previousPromise?this._previousPromise:this._previousImpl?(this._previousPromise=this._previousImpl().then(function(a){return b._previousPromise=null,d(b,a),b},function(c){b._previousPromise=null,a.reject(c)}),this._previousPromise):a.reject(e.EOL)}},e.EOL=b.error({type:"ExpandableList::EOL",message:"End of list reached"}),e}]),angular.module("hbpCommon").factory("hbpGroupStore",["$rootScope","$q","$http","$cacheFactory","bbpConfig","hbpUtil",function(a,b,c,d,e,f){var g=d("hbpGroupsCache"),h=e.get("api.user.v0")+"/group/",i=function(a){return c.get(h+a).then(function(a){return a.data},f.ferr)},j=function(a){var c=g.get(a);return c?b.when(c):k({filter:{name:a}}).then(function(c){return 1===c.results.length?(g.put(a,c.results[0]),c.results[0]):0===c.results.length?void 0:b.reject("getByName: unexpected number of results")})},k=function(a){var b=f.buildQueryParams(a);return f.getList(h,{params:b})()},l=function(a){return f.getList(h+a+"/members")()},m=function(a,b){var d={users:o(b)};return c.put(h+a+"/members",d).then(f.buildListResponse,f.ferr)},n=function(a,b){var d={users:o(b)};return c({method:"DELETE",url:h+a+"/members",data:d,headers:{"Content-Type":"application/json"}}).then(f.buildListResponse,f.ferr)},o=function(a){return _.isArray(a)?a:[a]};return{get:i,getByName:j,getMembers:l,addMembers:m,removeMembers:n,list:k}}]),angular.module("hbpCommon").service("hbpHiResService",function(){return{isHiResScreen:function(){return"devicePixelRatio"in window&&window.devicePixelRatio>1||"matchMedia"in window&&window.matchMedia("(min-resolution:144dpi)").matches},pixelRatio:function(){return window.devicePixelRatio||1}}}),angular.module("hbpCommon").service("hbpUiUtil",["$window","$document","$q","hbpErrorService",function(a,b,c,d){function e(c){c.find&&(c=c[0]);var d=c.getBoundingClientRect();return d.top>=0&&d.left>=0&&d.bottom<=(a.innerHeight||b.documentElement.clientHeight)&&d.right<=(a.innerWidth||b.documentElement.clientWidth)}var f=function(a,b){return function(e){var f=Array.prototype.slice.call(arguments);return f.shift(),a.apply(this,f).then(function(a){e(a)},function(a){b.error=d.httpError(a),c.reject(b.error)})}};return{isInViewport:e,dialogSubmissionRestCallErrorHandler:f}}]).filter("hbpDatetime",["$filter",function(a){return function(b){return a("date")(b,"yyyy-MM-dd HH:mm:ss")}}]).filter("hbpCapitalize",[function(){return function(a){return a.charAt().toUpperCase()+a.substring(1)}}]).filter("hbpMarkdown",["$sce",function(a){return function(b){return void 0!==b?a.trustAsHtml(marked(b,{sanitize:!0})):void 0}}]).run(["$rootScope","$log","$state","$stateParams","$location","$window",function(a,b,c,d,e,f){var g=0;a.$on("$stateChangeSuccess",function(a,b,c,d){d&&d.name&&!e.$$replace&&g++}),a.goToPrevious=function(a,d){g>0?(g--,f.history.go(-1)):a?c.go(a,d):b.error("no previous state, cannot navigate back.")}}]),angular.module("hbpCommon").factory("hbpUserDirectory",["$rootScope","$q","$http","$cacheFactory","bbpConfig","hbpUtil",function(a,b,c,d,e,f){var g=d("hbpUserCache"),h=e.get("api.user.v0"),i=h+"/user",j=h+"/group",k="_currentUser_",l="S12578";a.$on("user:disconnected",function(){g.removeAll()});var m=function(a,b,c){if(a.length>0){for(var d=b+a[0],e=1;e<a.length;e++)d.length+a[e].length+1<2e3?d+="%2B"+a[e]:(c.push(d),d=b+a[e]);c.push(d)}},n=function(a,b){for(var c=0;c<a.length;c++){var d=a[c];void 0===d.displayName&&(d.displayName=d.name),b[d.id]=d,g.put(d.id,d)}},o=function(a){var d=b.defer(),e=[],f=[],h={},k=[],l=function(){d.reject.apply(d,a)},o=function(a){return n(a.data.result,h),k&&k.length>0?c.get(k.shift()).then(o,l):void d.resolve(h)};return _.forEach(a,function(a){var b=g.get(a);b?h[a]=b:"S"===a[0]?f.push(a):e.push(a)}),e.length+f.length===0?d.resolve(h):(m(e,i+"?filter=id=",k),m(f,j+"?filter=id=",k),c.get(k.shift()).then(o,l)),d.promise},p=function(a){return this.getCurrentUser().then(function(b){var c=_.isArray(a)?a:[a];return _.some(c,function(a){return b.groups.indexOf(a)>-1})})};return{get:o,getCurrentUserOnly:function(){var a=g.get(k);return a?b.when(a):c.get(i+"/me").then(function(a){var b=a.data;return g.put(k,b),b},f.ferr)},getCurrentUser:function(){var a=g.get(k);if(a&&a.groups)return b.when(a);var d={};return a||(d.user=this.getCurrentUserOnly()),d.groups=c.get(i+"/me/groups"),b.all(d).then(function(b){var c=b.user||a;return c.groups=b.groups.data.result,g.put(k,c),c},f.ferr)},create:function(a){return c.post(i,a).then(function(){return a},f.ferr)},update:function(a,b){b=b||a;var d="string"==typeof a?a:a.id;return c.put(i+"/"+d,b).then(function(){g.remove(d);var a=g.get(k);return a&&a.id===d&&g.remove(k),o([d]).then(function(a){return _.first(_.values(a))})},f.ferr)},list:function(a){var b=f.buildQueryParams(a),c=i;return a&&a.managedOnly&&(c+="/managed"),f.getList(c,{params:b})()},isAdmin:function(){return this.getCurrentUser().then(function(a){return a.groups&&a.groups.indexOf(l)>-1})},isGroupMember:p,isGroupMemeber:p}}]),angular.module("hbpCommon").service("hbpUtil",["$q","$http","hbpErrorService",function(a,b,c){function d(a,b){return new e(a,b)}function e(d,e){function f(b){return o.promise=a.when(o.promise.then(b))["catch"](l),o.promise}function g(a){j(a),n(a.data)}function h(){return f(function(){return b.get(o.nextUrl).then(j)})}function i(){return f(function(){return b.get(o.previousUrl).then(k)})}function j(a){var b=a.data;return o.results.push.apply(o.results,b[e.resultKey]),m(b),a}function k(a){var b=a.data;return o.results.unshift.apply(o.results,b[e.resultKey]),n(b),a}function l(b){return o.error=c.httpError(b),angular.isFunction(e.errorHandler)&&e.errorHandler(o.error),a.reject(o.error)}function m(a){o.nextUrl=a[e.nextUrlKey],o.hasNext=!!o.nextUrl}function n(a){o.previousUrl=a[e.previousUrlKey],o.hasPrevious=!!o.previousUrl}var o=this;o.results=[],o.error=null,o.hasNext=null,o.hasPrevious=null,o.promise=null,o.errorHandler=null,o.next=h,o.previous=i,e=angular.extend({resultKey:"results",nextUrlKey:"next",previousUrlKey:"previous"},e),o.promise=a.when(d).then(g)["catch"](l)}var f=function(b){return a.reject(c.httpError(b))},g=function(a){var b,c={page:0,pageSize:10,managedOnly:!1},d=angular.extend(c,a);if(d.filter){var e=_.map(d.filter,function(a,b){return _.isArray(a)&&(a=a.join("+")),b+"="+a});b=e.join()}var f;return d.sort&&(f=_.isArray(d.sort)?d.sort.join():_(d.sort).toString()),{page:d.page,pageSize:d.pageSize,filter:b,sort:f}},h=function(a){var b={};return void 0!==a.data.result?(b.results=a.data.result,b.result=b.results):void 0!==a.data.results?b.results=a.data.results:console.log("Failed to get a result/results member: ",a.data),b.count=a.data.count||b.results.length,a.data.next&&(b.next=i(a.data.next)),a.data.previous&&(b.previous=i(a.data.previous)),b},i=function(a,c){return function(){return b.get(a,c).then(h,f)}};return{format:function(a,b){return angular.isArray(b)||(b=[b]),a.replace(/{(\d+)}/g,function(a,c){return"undefined"!=typeof b[c]?b[c]:a})},buildQueryParams:g,buildListResponse:h,getList:i,paginatedResultSet:d,ferr:f}}]),angular.module("hbpCommon").config(["$httpProvider",function(a){window.XMLHttpRequest=function(a){return function(){var b=new a;return b.setRequestHeader=function(a){return function(c,d){"HBP-AngularProgressEventMixin"===c?d.call(b,b):a.apply(this,arguments)}}(b.setRequestHeader),b}}(window.XMLHttpRequest),a.interceptors.push("hbpXhrProgressEventInterceptor")}]).factory("hbpXhrProgressEventInterceptor",function(){return{request:function(a){return(a.uploadProgress||a.progress)&&(a.headers["HBP-AngularProgressEventMixin"]=function(b){a.uploadProgress&&b.upload.addEventListener("progress",a.uploadProgress,!1),a.progress&&b.addEventListener("progress",a.progress,!1)}),a}}}),angular.module("hbp-common-templates",["templates/breadcrumb.html","templates/content-description.html","templates/content-icon.html","templates/dialog-alert.html","templates/dialog-confirmation.html","templates/error-alert.html","templates/error-message.html","templates/icon.html","templates/userSelector.html","templates/usercard.html"]),angular.module("templates/breadcrumb.html",[]).run(["$templateCache",function(a){a.put("templates/breadcrumb.html",'<ol class="breadcrumb">\n    <li ng-repeat="item in parentItems"\n        ><a ng-href="{{urlForState(item.state, item.stateParams)}}"\n            ><hbp-icon type="item.type"></hbp-icon>\n            <span class="breadcrumb-item-name {{item.class}}">{{item.name}}</span\n        ></a\n    ></li\n    ><li\n        ><hbp-icon type="currentItem.type"></hbp-icon>\n        <span class="breadcrumb-item-name {{currentItem.class}}">{{currentItem.name}}</span\n    ></li>\n</ol>\n')}]),angular.module("templates/content-description.html",[]).run(["$templateCache",function(a){a.put("templates/content-description.html",'<span ng-switch="content">\n    <span ng-switch-when="application/vnd.bbp.FeatureExtract.Dependency+txt">Text FeatureExtract</span>\n    <span ng-switch-when="application/vnd.bbp.SimulationProtocol.StimulationConfig">Simulation Configuration</span>\n    <span ng-switch-when="application/vnd.bbp.SimulationProtocol.ReportingConfig">Reporting Configuration</span>\n    <span ng-switch-when="application/vnd.bbp.Circuit.Config+config">Circuit Configuration</span>\n    <span ng-switch-when="application/vnd.bbp.Circuit.Config">Circuit Configuration</span>\n    <span ng-switch-when="application/vnd.bbp.Circuit.Combination">Circuit Combination</span>\n    <span ng-switch-when="application/vnd.bbp.Circuit.Combination+xml">XML Circuit Combination</span>\n    <span ng-switch-when="application/vnd.bbp.Simulation.BlueConfig">BlueConfig File</span>\n    <span ng-switch-when="application/vnd.bbp.Simulation.HOC">HOC Simulation</span>\n    <span ng-switch-when="application/vnd.bbp.bundle.Image.png">Image Bundle</span>\n    <span ng-switch-when="application/zip">Archive</span>\n    <span ng-switch-when="application/rar">Archive</span>\n    <span ng-switch-when="application/json">JSON</span>\n    <span ng-switch-when="application/txt">Plain Text</span>\n    <span ng-switch-when="text/plain">Plain Text</span>\n    <span ng-switch-when="image/jpeg">JPEG Image</span>\n    <span ng-switch-when="image/png">PNG Image</span>\n    <span ng-switch-when="image/gif">GIF Image</span>\n    <span ng-switch-when="video/avi">AVI Video</span>\n    <span ng-switch-when="video/mpg">MPEG Video</span>\n    <span ng-switch-when="model/vnd.bbp.Morphology.Morphology">Morphology</span>\n    <span ng-switch-when="model/vnd.bbp.Morphology.Morphology+asc">ASCI Morphology</span>\n    <span ng-switch-when="model/vnd.bbp.Morphology.Morphology+h5">H5 Morphology</span>\n    <span ng-switch-when="model/vnd.bbp.Morphology.NeuronDB">DAT NeuronDB</span>\n    <span ng-switch-when="model/vnd.bbp.Morphology.NeuronDB+dat">DAT NeuronDB</span>\n    <span ng-switch-default>{{fallback}}</span>\n</span>\n')}]),angular.module("templates/content-icon.html",[]).run(["$templateCache",function(a){a.put("templates/content-icon.html",'<span class="bbp-browser-entity-icon" ng-switch="content">\n    <i ng-switch-when="application/zip" class="fa fa-file-archive-o"></i>\n    <i ng-switch-when="application/rar" class="fa fa-file-archive-o"></i>\n    <i ng-switch-when="application/txt" class="fa fa-file-text-o"></i>\n    <i ng-switch-when="text/plain" class="fa fa-file-text-o"></i>\n    <i ng-switch-when="application/pdf" class="fa fa-file-pdf-o"></i>\n    <i ng-switch-when="image/jpeg" class="fa fa-file-image-o"></i>\n    <i ng-switch-when="image/png" class="fa fa-file-image-o"></i>\n    <i ng-switch-when="image/gif" class="fa fa-file-image-o"></i>\n    <i ng-switch-when="application/json" class="fa fa-file-code-o"></i>\n    <i ng-switch-when="video/avi" class="fa fa-file-video-o"></i>\n    <i ng-switch-when="video/mpeg" class="fa fa-file-video-o"></i>\n    <i ng-switch-default class="fa fa-file-o"></i>\n</span>\n')}]),angular.module("templates/dialog-alert.html",[]).run(["$templateCache",function(a){a.put("templates/dialog-alert.html",'<div class="modal-header"  >\n    <button type="button" class="close" ng-click="$close()" aria-hidden="true">&times;</button>\n    <h4 class="modal-title">{{title}}</h4>\n</div>\n<div class="modal-body {{htmlClass}}">\n    <ng-include src="alertContentUrl"></ng-include>\n    {{alertContent}}\n</div>\n<div class="modal-footer">\n    <button class="btn btn-default" ng-click="$close()">{{label}}</button>\n</div>\n')}]),angular.module("templates/dialog-confirmation.html",[]).run(["$templateCache",function(a){a.put("templates/dialog-confirmation.html",'<div class="modal-header"  >\n    <button type="button" ng-show="closable" class="close" ng-click="$dismiss(\'cancel\')" aria-hidden="true">&times;</button>\n    <h4 class="modal-title">{{title}}</h4>\n</div>\n<div class="modal-body">\n    <alert ng-if="error" type="danger">{{error.reason}}</alert>\n    <ng-include ng-if="confirmationContentUrl" src="confirmationContentUrl"></ng-include>\n    {{confirmationContent}}\n</div>\n<div class="modal-footer">\n    <button class="btn btn-default" ng-click="$dismiss(\'cancel\')">{{cancelLabel}}</button>\n    <button class="btn btn-danger" ng-click="$close()">{{confirmLabel}}</button>\n</div>\n')}]),angular.module("templates/error-alert.html",[]).run(["$templateCache",function(a){a.put("templates/error-alert.html",'<div class="alert alert-danger">[{{error.type}}] {{error.message}}</div>\n<pre><code>{{error | json}}</code></pre>\n')}]),angular.module("templates/error-message.html",[]).run(["$templateCache",function(a){a.put("templates/error-message.html",'<alert type="danger" ng-if="error">\n    <div ng-switch on="error.type">\n        <div ng-switch-when="Validation">\n                Validation errors<span ng-show="error.data">:</span>\n            <ul>\n            <li ng-repeat="(attr, errors) in error.data">{{attr}}: {{errors.join(\', \')}}</li>\n        </ul>\n        </div>\n        <div ng-switch-default>\n            {{error.message}}\n        </div>\n    </div>\n</alert>')}]),angular.module("templates/icon.html",[]).run(["$templateCache",function(a){a.put("templates/icon.html",'<span class="bbp-browser-entity-icon" ng-switch="type">\n    <i ng-switch-when="root" class="glyphicon glyphicon-home"></i>\n    <i ng-switch-when="project" class="glyphicon glyphicon-hdd"></i>\n    <i ng-switch-when="folder" class="glyphicon glyphicon-folder-open"></i>\n    <i ng-switch-when="file" class="glyphicon glyphicon-file"></i>\n    <i ng-switch-when="release" class="glyphicon glyphicon-lock"></i>\n    <i ng-switch-when="link:folder" class="glyphicon glyphicon-link"></i>\n    <i ng-switch-when="link:file" class="glyphicon glyphicon-link"></i>\n    <i ng-switch-when="link:project" class="glyphicon glyphicon-link"></i>\n    <i ng-switch-when="link:release" class="glyphicon glyphicon-link"></i>\n</span>\n')}]),angular.module("templates/userSelector.html",[]).run(["$templateCache",function(a){a.put("templates/userSelector.html",'<div class="input-group hbp-user-selector" ng-class="{\'has-error\': false}">\n    <input class="form-control" ng-model="newUser" type="text" placeholder="type user name"\n      typeahead="user as user.displayName for user in getUsers($viewValue)"\n      typeahead-editable="false"\n      typeahead-on-select="selectUser()"\n      typeahead-min-length="3"\n      ng-keypress="noSubmitOnEnter($event)"\n      name="new-user"\n      ng-disabled="selectionDisabled">\n    <span class="input-group-btn">\n      <button ng-click="selectUser()" class="btn btn-default" type="button"><i class="glyphicon glyphicon-plus"></i></button>\n    </span>\n</div>')}]),angular.module("templates/usercard.html",[]).run(["$templateCache",function(a){a.put("templates/usercard.html",'<div ng-if="user" class="hbp-usercard hbp-card hbp-card-default">\n    <h3 class="hbp-usercard-name">\n        {{user.displayName}}\n    </h3>\n    <div class="hbp-usercard-pix">\n        <img ng-src="{{user.picture}}" ng-if="user.picture" />\n        <hbp-generated-icon hbp-text="user.displayName" ng-if="!user.picture"></hbp-generated-icon>\n    </div>\n    <div class="hbp-usercard-institution" ng-if="institution">\n        <span class="hbp-usercard-institution-title">{{institution.title}}</span>,\n        <span class="hbp-usercard-institution-name">{{institution.name}}</span>,\n        <span class="hbp-usercard-institution-dept">{{institution.department}}</span>\n    </div>\n    <div class="hbp-usercard-contact">\n        <a class="hbp-usercard-contact-item hbp-usercard-email" target="_top" href="mailto:{{email}}" ng-if="email"><span class="glyphicon glyphicon-envelope"></span> {{email}}</a>\n        <span class="hbp-usercard-contact-item hbp-usercard-phone" ng-if="phone"><span class="glyphicon glyphicon-phone"></span> {{phone}}</span>\n        <span class="hbp-usercard-contact-item hbp-usercard-im-list" ng-if="ims.length"><span class="glyphicon glyphicon-bullhorn"></span>\n            <span class="hbp-usercard-im" ng-repeat="im in ims">\n                {{im.value}}({{im.type}})\n            </span>\n        </span>\n    </div>\n</div>\n')}]);